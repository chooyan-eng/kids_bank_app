# SPEC.md — こどもぎんこう アプリ仕様書

最終更新: 2026-02-19

---

## 1. アプリ概要

### 1.1 アプリ名

**こどもぎんこう**

### 1.2 目的

親が子どもごとのお小遣い口座を管理するための家庭用アプリ。
銀行ごっこを通じて、子どもが「貯める・もらう・使う」という金銭感覚を自然に身につけることを支援する。

### 1.3 コンセプト

- **シンプル最優先**: 専用の金融アプリではなく、家族が気軽に使えるツール
- **親が操作する**: 入出金・利率設定はすべて親が管理する
- **子どもが見て楽しめる**: 残高や履歴を子どもと一緒に確認できる UI

---

## 2. 対象ユーザー

| ユーザー | 役割 |
|---|---|
| 親（保護者） | アプリの主操作者。子ども口座の作成・入出金・設定を行う |
| 子ども | 残高・履歴の確認のみ（操作はしない想定）|

対象年齢の子ども: 概ね 4〜12 歳

---

## 3. 機能一覧

### 3.1 子ども口座管理

- 子どもを複数登録できる（人数制限なし）
- 各子どもに以下を設定できる:
  - 名前
  - アイコン（ギャラリーから画像選択 / 手書き描画）
  - 利率（年利、% 単位、小数点第 1 位まで）

### 3.2 入出金（預け入れ / 引き出し）

- 親が操作して残高を増減する
- 入力項目:
  - 金額（double 型。表示は円単位・小数点以下なし）
  - 種別（入金 / 出金）
  - 用途・メモ（任意、テキスト）
  - 日付（デフォルト: 本日。変更可能）
- 金額が残高を超える引き出しも許可する（残高のマイナスは許容）

### 3.3 利息機能

- 利率は子ども口座ごとに親が設定（年利 %）
- 利息付与は**自動**。アプリ起動時または子ども詳細画面を開いたタイミングで付与判定を行う
- 付与タイミング: 前回の利息付与から 1 ヶ月以上経過している場合に自動付与
  - 初回は口座作成日から 1 ヶ月後
- 計算方法: `利息 = 残高 × 年利 ÷ 12`（月利として付与）
- 付与された利息は通常の入金履歴と同様にトランザクションとして記録する
- 種別フラグ: `interest`（利息）として区別できるようにする
- 1 円未満は切り捨て
- 利率が 0% の場合は付与しない（トランザクションも作成しない）

### 3.4 取引履歴

- 子どもごとの入出金・利息の全履歴を時系列（新しい順）で表示
- 各履歴に表示する情報:
  - 取引日
  - 種別アイコン（入金 / 出金 / 利息）
  - 金額
  - 取引後残高
  - 用途・メモ
- フィルタ機能（Phase 2）: 種別・期間絞り込み

### 3.5 子どもアイコン設定

2 種類の方法でアイコンを設定できる:

| 方法 | 説明 |
|---|---|
| ギャラリー | デバイスの写真ライブラリから 1 枚選択。正方形にクロップして保存 |
| 手書き | アプリ内のキャンバスに指で描いた絵をアイコンとして使用 |

手書きキャンバスの仕様（Phase 1 MVP では省略可、Phase 2 で実装）:
- 白背景の正方形キャンバス
- ペンの色・太さを選べる（最低限: 黒・赤・青、太さ 3 段階）
- 消しゴム機能
- 「やり直し（Undo）」ボタン
- 完了ボタンで PNG として保存

---

## 4. データモデル

### 4.1 Child（子ども）

| フィールド | 型 | 説明 |
|---|---|---|
| id | String (UUID) | 一意識別子 |
| name | String | 子どもの名前 |
| iconType | enum: gallery / drawing | アイコンの種別 |
| iconImagePath | String? | 画像ファイルパス（未設定の場合は名前の頭文字アバターを表示） |
| interestRatePercent | double | 年利（%）。例: 5.0 = 年 5% |
| balance | double | 現在の残高（円） |
| lastInterestAppliedAt | DateTime? | 直近の利息付与日時（null = 未付与） |
| createdAt | DateTime | 作成日時 |

### 4.2 Transaction（取引）

| フィールド | 型 | 説明 |
|---|---|---|
| id | String (UUID) | 一意識別子 |
| childId | String | 対象子どもの ID |
| type | enum: deposit / withdrawal / interest | 取引種別 |
| amount | double | 金額（円、常に正の値） |
| balanceAfter | double | 取引後残高（円） |
| memo | String | 用途・メモ（空文字可） |
| date | DateTime | 取引日 |
| createdAt | DateTime | レコード作成日時 |

> **設計メモ**
> - `amount` は常に正の値。方向は `type` で表現する（入金なら +、出金なら −）
> - `balance` は `Child` に冗長保存し、取引ごとに `balanceAfter` も保存する
>   → 表示時に再集計が不要になり、任意時点の残高も即座に参照できる

### 4.3 AppSettings（アプリ設定）※Phase 2

| フィールド | 型 | 説明 |
|---|---|---|
| themeColorHex | String | テーマカラー |

> **通貨**: 現行は日本円（¥）固定。金額フィールドを `double` 型で保持することで、将来の外貨対応に備える。

---

## 5. 画面構成・フロー

### 5.1 画面・ダイアログ一覧

| ID | 種別 | 名前 | 説明 |
|---|---|---|---|
| S01 | 画面 | ホーム画面 | 全員の残高をファーストビューで確認。基本操作はここで完結 |
| S02 | 画面 | 子ども詳細画面 | 取引履歴（全件）と口座情報の確認 |
| S03 | 画面 | 子ども追加・編集画面 | 名前・アイコン・利率の設定 |
| S04 | 画面 | アイコン選択画面 | ギャラリー / 手書きを選ぶ |
| S05 | 画面 | 手書きキャンバス画面 | 指で絵を描いてアイコンを作成（Phase 2） |
| D01 | ダイアログ | 入出金ダイアログ | 入金 / 出金 の操作フォーム（モーダル） |

### 5.2 画面フロー

```
起動
  └─ S01: ホーム画面
       ├─ カードの「入金」「出金」ボタン ── D01: 入出金ダイアログ
       ├─ 子どもカードタップ ────────────── S02: 子ども詳細画面
       │                                         ├─ 「入金」「出金」ボタン ─ D01: 入出金ダイアログ
       │                                         └─ 「編集」メニュー ─────── S03: 子ども編集画面
       └─ 「+」ボタン（子ども追加） ──────── S03: 子ども追加画面
                                                  └─ アイコン変更タップ ──── S04: アイコン選択画面
                                                                                   ├─ ギャラリー
                                                                                   └─ 手書き ─── S05
```

### 5.3 各画面・ダイアログの詳細

#### S01: ホーム画面

- 子どものカードを縦スクロールで表示
- カード内に表示する情報: アイコン、名前、現在残高、利率
- 各カードに「入金」「出金」ボタンを配置 → タップで D01 を開く
- カードをタップ → S02（子ども詳細）へ遷移
- 右下の FAB（FloatingActionButton）で子ども追加（S03 へ遷移）
- カードが 0 件のときは「最初の子どもを追加しよう」の案内を表示

#### S02: 子ども詳細画面

- ヘッダー: アイコン（大）、名前、残高（大きなフォント）、利率
- 全取引履歴のリスト表示（新しい順）
  - 各行: 日付、種別アイコン、メモ、金額（＋/− 付き）、残高
  - 月ごとのセクションヘッダーで区切る
- 「入金」「出金」ボタン → D01 を開く
- 右上のメニューから「編集」（S03）・「削除」

#### S03: 子ども追加・編集画面

- アイコンプレビュー（タップで S04 へ）
- 名前入力フィールド
- 利率入力フィールド（小数点 1 位まで）
- 「保存」ボタン

#### S04: アイコン選択画面

- 2 つの選択肢をカード UI で表示
  1. ギャラリーから選ぶ
  2. 手書きで描く

#### D01: 入出金ダイアログ

- 種別切り替え: 入金 / 出金 のセグメントコントロール
- 金額入力（数値キーボード）
- 日付入力（DatePicker、デフォルト今日）
- メモ入力（任意）
- 「確定」ボタン / 「キャンセル」ボタン

---

## 6. UI・デザイン方針

- Material Design 3 を基本とする
- カラーパレット: 温かみのある暖色系（オレンジ・黄色ベース）または明るいグリーン。子どもらしさを演出
- フォント: システムデフォルト（日本語対応）。残高表示は太字・大サイズ
- アイコン: Material Icons を基本。カスタムアイコンは最小限
- アニメーション: 残高更新時に数字がカウントアップするアニメーションを検討（Phase 2）
- ダークモード: Phase 2 以降で対応

---

## 7. 永続化・データ保存

- ローカルストレージのみ（クラウド同期は対象外）
- データはデバイス内に保存し、アプリを再起動しても保持される
- 具体的な実装ライブラリは `docs/TECH_NOTES.md` を参照

---

## 8. フェーズ計画

### Phase 1: MVP

目標: 最低限の操作が動く状態を素早くリリースする

| # | 機能 | 詳細 |
|---|---|---|
| 1 | 子ども登録・編集・削除 | 名前・利率（アイコンは頭文字アバターで代替） |
| 2 | 入金・出金 | 金額・日付・メモ付き |
| 3 | 残高表示 | ホーム画面カード、詳細画面 |
| 4 | 取引履歴 | 一覧表示（フィルタなし） |
| 5 | 利息自動付与 | 起動時・詳細画面表示時に 1 ヶ月経過を判定し自動付与 |
| 6 | ローカル永続化 | アプリ再起動後もデータ保持 |

**Phase 1 ではアイコン設定機能はスコープ外とする**（未設定時は名前の頭文字アバターを表示。ギャラリー・手書きは Phase 2 で実装）

### Phase 2: 機能拡充

| # | 機能 | 詳細 |
|---|---|---|
| 1 | ギャラリーアイコン | Method Channel (Swift) + crop_your_image でクロップ |
| 2 | 手書きアイコン | キャンバスで描いてアイコン化 |
| 3 | 履歴フィルタ | 種別・期間での絞り込み |
| 4 | 残高グラフ | 推移をシンプルな折れ線グラフで表示 |
| 5 | 利息付与通知 | 利息が自動付与されたタイミングでプッシュ通知 |
| 6 | テーマカラー変更 | 子どもごとにカードの色をカスタマイズ |
| 7 | データエクスポート | CSV 形式で取引履歴を書き出す |

### Phase 3: 将来的な拡張（未確定）

- 複数デバイス間でのデータ共有（クラウド同期）
- 子どもが自分でアプリを確認できるビュー（読み取り専用モード）
- お手伝いタスク管理との連携（タスク完了でお小遣い付与）

---

## 9. 非機能要件

| 項目 | 要件 |
|---|---|
| 対応プラットフォーム | iOS のみ（macOS は開発・動作確認用） |
| Method Channel | iOS (Swift) のみ実装。Android 対応は対象外 |
| オフライン動作 | 完全オフライン（ネットワーク不要） |
| データ紛失リスク | バックアップ非対応（Phase 1）。エクスポートで代替（Phase 2） |
| セキュリティ | PIN ロック等は対象外（家庭内利用を前提） |
| パフォーマンス | 子ども 10 人・取引 1,000 件程度で問題なく動作すること |

---

## 10. 決定済み事項

| 項目 | 決定内容 |
|---|---|
| アプリ名 | こどもぎんこう |
| プリセットアイコン | 採用しない（頭文字アバターをデフォルト表示） |
| 負の残高 | 許可 |
| 通貨 | 日本円固定 |
| 対応 OS | iOS のみ |
| タブレット対応 | 対象外 |
